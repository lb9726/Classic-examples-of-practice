
#include<stdlib.h>
#include<stdio.h>
#include<string.h>

void Test()
{
    char *str = (char *)malloc(100);
    printf("malloc is str = %p\n", str);
    strcpy(str, "hello");
    free(str);
    printf("after free str = %p\n", str);
    if (NULL != str)
    {
        strcpy(str,"world");
        printf("str = %s after free\n", str);
    }
    printf("str = %c after free\n", *str);
    return ;
}

int main()
{
    Test();
    return 0;
}

free(str)之后，str成为野指针， if (NULL != str)语句不起作用


而关于free之后，p的之后为何没有改变，仍然还是这个原先堆空间的这个地址，原因在于free函数仅仅是将malloc申请的内存释放回去，所谓的释放也就是告诉编译器，这块内存已经使用完毕，可以收回了。但指针所指向的内存值，并不会发生改变。就可以比方说，你租了一套房子，到期后，房子收回归还房东，而此时你可能还拿着房子的钥匙，这个时候你虽然可以继续访问这个房子(内存)，但已经不属于你，是非法的。也可能有新的租客入驻更改房子的内置，也可能还是这个样子。取决于不同的房东(编译器)和租客(内容)。

这就是free释放内存后，指针内地址仍然存在，但有时还可以访问，有时候访问输出乱码或输出其他值的原因。


你释放的是指针所指向的内容。指针本身不会被释放。
例如free(p)；
p=NULL;
都是合法的。
但是如果你要访问*p则会出错 
向被free掉的区域拷贝数据，其行为是未定义的。也就是说有可能正确也有可能错误。你将程序release发布一下，多试几台机子，估计就会出错了。





#include <stdio.h>  
#include <conio.h>  
#include <stdlib.h>  
#include <string.h>  
int main(void)  
{  
    char *ptr;  
    ptr=(char *)malloc(100);  
    strcpy(ptr,"Hello");  
    free(ptr);     // ptr 所指的内存被释放，但是ptr所指的地址仍然不变，原来的内存变为“垃圾”内存（不可用内存)
    if (ptr!=NULL) //    没有起到防错作用  
    {  
        strcpy(ptr," world");  
        printf("%s\n",ptr);  
    }  
    getch();  
    return 0;  
}  


free(str)后指针仍然指向原来的堆地址，即你仍然可以继续使用，但很危险，因为操作系统已经认为这块内存可以使用，他会毫不考虑的将他分配给其他程序，于是你下次使用的时候可能就已经被别的程序改掉了，这种情况就叫“野指针”，所以最好free（）了以后再置空
str = NULL;即本程序已经放弃再使用他。
何谓“野指针”，在这里补充一下。
野指针是指程序员或操作者不能控制的指针。野指针不是NULL指针，而是指向“垃圾”的指针。
造成“野指针”的原因主要有
1.指针变量没有初始化，任何指针变量刚被创建时不会自动成为NULL指针，它的缺省值是随机的，它会乱指一气。在初始化的时候要么指向合法的指针，要么指向NULL。
2.指针变量被free或delete之后，没有设置为NULL。它们只是把指针所指的内存给释放掉，但并没有把指针本身干掉。通常会用语句if (p != NULL)进行防错处理。很遗憾，此时if语句起不到防错作用，因为即便p不是NULL指针，它也不指向合法的内存块。上文DEMO则是这种情况。
3.指针操作超越了变量的作用范围。  注意其生命周期。

【下面是摘自论坛里面的形象比喻，加深理解。】
CRT的内存管理模块是一个管家。   
你的程序（简称“你”）是一个客人。   
管家有很对水桶，可以用来装水的。   
malloc的意思就是“管家，我要XX个水桶”。   
管家首先看一下有没有足够的水桶给你，如果没有，那么告诉你不行。如果够，那么登记这些水桶已经被使用了，然后告诉你“拿去用吧”。   
free的意思就是说：“管家我用完了，还你！”。   
至于你是不是先把水倒干净才给管家，那么是自己的事情了。－－是不是清零。   
管家也不会将你归还的水桶倒倒干清（他有那么多水桶，每个归还都倒干净岂不累死了）。反正其他用的时候自己会处理的啦。   
free之后将指针清零只是提醒自己，这些水桶已经不是我的了，不要再完里面放水了，^_^   
如果free了之后还用那个指针的话，就有可能管家已经将这些水桶给了其他人装饮料的了，你却往里面撒了泡尿。好的管家可能会对你的行为表示强烈的不满， 杀了你（非法操作）－－这是最好的结果，你知道自己错了（有错就改嘛）。一些不好的管家可能忙不过来，有时候抓到你作坏事就惩罚你，有时候却不知道去那里 了－－这是你的恶梦，不知道什么时候、怎么回事情自己就死了。不管怎么样，这种情况下很有可能有人要喝尿－－不知道是你的老板还是你的客户了.^_^。   
所以啊，好市民当然是还了给管家的东西就不要再占着啦，.^_^。


